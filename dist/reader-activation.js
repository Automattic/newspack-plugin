!function(){"use strict";var e={d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{on:function(){return d},off:function(){return s},setReaderEmail:function(){return l},setAuthenticated:function(){return h},refreshAuthentication:function(){return f},getReader:function(){return p},hasAuthLink:function(){return _},getOTPHash:function(){return m},authenticateOTP:function(){return g},setAuthStrategy:function(){return w},getAuthStrategy:function(){return y},getCaptchaToken:function(){return k}});const n={reader:"reader"},a={};function r(e){if(!e)return"";const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?decodeURIComponent(t.pop().split(";").shift()):void 0}function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:365;const a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),document.cookie=`${e}=${t}; expires=${a.toUTCString()}; path=/`}const o=Object.values(n);function c(e){return o.includes(e)?`newspack-reader-activation-${e}`:""}function u(e,t){if(!(e=c(e)))throw"Invalid event";window.dispatchEvent(new CustomEvent(e,{detail:t}))}function d(e,t){if(!(e=c(e)))throw"Invalid event";window.addEventListener(e,t)}function s(e,t){if(!(e=c(e)))throw"Invalid event";window.removeEventListener(e,t)}function l(e){e&&(a.reader||(a.reader={}),a.reader.email=e,u(n.reader,a.reader))}function h(){var e;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(null===(e=a.reader)||void 0===e||!e.email)throw"Reader email not set";a.reader.authenticated=Boolean(t),u(n.reader,a.reader)}function f(){const e=r("np_auth_reader");e?(l(e),h(!0)):l(r("np_auth_intention"))}function p(){return a.reader}function _(){const e=p(),t=r("np_auth_link");return!(null==e||!e.email||!t)}const v=["pwd","link"];function m(){return r("np_otp_hash")}function g(e){return new Promise(((t,n)=>{var a;const r=m(),i=null===(a=p())||void 0===a?void 0:a.email;return r?i?e?void fetch("",{method:"POST",headers:{Accept:"application/json"},body:new URLSearchParams({action:newspack_reader_activation_data.otp_auth_action,email:i,hash:r,code:e})}).then((e=>e.json())).then((e=>{let{success:a,message:r,data:o}=e;const c={...o,email:i,authenticated:!!a,message:r};h(!!a),a?t(c):n(c)})):n({message:"Invalid code"}):n({message:"You must provide an email"}):n({message:"Code has expired",expired:!0})}))}function w(e){if(!v.includes(e))throw"Invalid authentication strategy";return i("np_auth_strategy",e),e}function y(){return m()?"otp":r("np_auth_strategy")}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"submit";return new Promise(((t,n)=>{const{grecaptcha:a}=window;if(!a||!newspack_reader_activation_data)return t("");const{captcha_site_key:r}=newspack_reader_activation_data;null!=a&&a.ready&&r||n("Error loading the reCaptcha library."),a.ready((()=>{a.execute(r,{action:e}).then((e=>t(e))).catch((e=>n(e)))}))}))}!function(){const e=newspack_reader_activation_data,t=(null==e?void 0:e.authenticated_email)||r("np_auth_intention"),i=!(null==e||!e.authenticated_email);a.reader=t?{email:t,authenticated:i}:null,u(n.reader,a.reader)}();const b={on:d,off:s,setReaderEmail:l,setAuthenticated:h,refreshAuthentication:f,getReader:p,hasAuthLink:_,getOTPHash:m,authenticateOTP:g,setAuthStrategy:w,getAuthStrategy:y,getCaptchaToken:k};window.newspackReaderActivation=b;const P=newspack_reader_activation_data.cid_cookie;if(!r(P)){const e=()=>Math.floor(999999999*Math.random()).toString(36);i(P,`${e()}${e()}`)}t.default=b;var S=window;for(var A in t)S[A]=t[A];t.__esModule&&Object.defineProperty(S,"__esModule",{value:!0})}();